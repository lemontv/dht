"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var crypto = require("crypto");
var dgram = require("dgram");
var buffer_1 = require("buffer");
var bencode_1 = require("@lemontv/bencode");
var query_1 = require("./query");
var message_1 = require("./message");
var BOOTSTRAP_HOST = "router.bittorrent.com";
var BOOTSTRAP_PORT = 6881;
var buf = crypto.randomBytes(2048);
var sha1 = crypto.createHash("sha1");
sha1.update(buf);
var token = sha1.digest().toString("ascii");
var query = new query_1.Query(token);
var server = dgram.createSocket("udp4");
server.on("message", function (msg, rinfo) { return message_1.handleMessage(server, msg, rinfo); });
var ping = buffer_1.Buffer.from(bencode_1.encode(query.ping()));
var findNode = buffer_1.Buffer.from(bencode_1.encode(query.find_node({ target: token })));
server.send(ping, BOOTSTRAP_PORT, BOOTSTRAP_HOST);
server.send(findNode, BOOTSTRAP_PORT, BOOTSTRAP_HOST);
